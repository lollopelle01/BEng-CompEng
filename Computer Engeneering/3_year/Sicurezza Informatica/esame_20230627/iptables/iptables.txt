## Client ######################################################################################################
iptables -A OUTPUT -s 172.16.0.0/16 -d 192.168.99.0/24 -i eth1 --dport 443 -p https -j ACCEPT
iptables -A OUTPUT -s 172.16.0.2 -d 192.168.99.2 -i eth1 --dport 22 -p tcp -j ACCEPT
iptables -I INPUT -i lo -j ACCEPT
iptables -I OUTPUT -o lo -j ACCEPT

iptables -P OUTPUT DROP

## R1 ######################################################################################################
iptables -A INPUT -s 10.5.5.2 -d 10.5.5.1 -i eth2 -j ACCEPT
iptables -A OUTPUT -s 10.5.5.1 -d 10.5.5.2 -i eth2 -j ACCEPT
iptables -A FORWARD -s 172.16.0.0/16 -d 192.168.99.0/24 -j ACCEPT
iptables -A FORWARD -s 192.168.99.0/24 -d 172.16.0.0/16 -j ACCEPT
iptables -t nat -I POSTROUTING -s 172.16.0.0/16 -d 192.168.99.2 -j SNAT --to-source 10.5.5.1

iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP
 
## R2 ######################################################################################################
iptables -A OUTPUT -s 10.5.5.2 -d 10.5.5.1 -i eth2 -j ACCEPT
iptables -A INPUT -s 10.5.5.1 -d 10.5.5.2 -i eth2 -j ACCEPT
iptables -A FORWARD -s 172.16.0.0/16 -d 192.168.99.0/24 -j ACCEPT
iptables -A FORWARD -s 10.5.5.1 -d 192.168.99.0/24 -j ACCEPT
iptables -A FORWARD -s 192.168.99.0/24 -d 172.16.0.0/16 -j ACCEPT

iptables -P INPUT DROP
iptables -P OUTPUT DROP
iptables -P FORWARD DROP

## Server ######################################################################################################
iptables -A OUTPUT -s 192.168.99.2 -d 10.5.5.0/30 -i eth1 --dport 22 -p tcp -m state --state ESTABLISHED -j ACCEPT
iptables -A INPUT -s 10.5.5.1 -d 192.168.99.2 -i eth1 --dport 22 -p tcp -j ACCEPT
iptables -I INPUT -i lo -j ACCEPT
iptables -I OUTPUT -o lo -j ACCEPT

iptables -P OUTPUT DROP
