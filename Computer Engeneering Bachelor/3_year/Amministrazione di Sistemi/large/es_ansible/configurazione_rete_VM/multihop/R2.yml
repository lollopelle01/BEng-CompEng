---
- hosts: all
  become: true
  tasks:
    - name: Copia e configurazione di eth1
      ansible.builtin.copy:
        src: R2eth1
        dest: /etc/network/interfaces.d/eth1
        validate: /usr/sbin/ifup --no-act -i %s eth1
      notify: Restart Networking

    - name: Copia e configurazione di eth2
      ansible.builtin.copy:
        src: R2eth2
        dest: /etc/network/interfaces.d/eth2
        validate: /usr/sbin/ifup --no-act -i %s eth2
      notify: Restart Networking

    - name: Change allow-hotplug with auto
      ansible.builtin.replace: 
        path: '/etc/network/interfaces'
        regexp: '^allow\-hotplug'
        replace: 'auto'
        validate: /usr/sbin/ifup --no-act -i %s eth0

    - name: Ensure routing is allowed
      ansible.builtin.lineinfile:
        path: '/etc/sysctl.conf'
        state: present
        line: 'net.ipv4.ip_forward=1'
      notify: Reload Sysctl

  handlers:
    - name: Restart Networking
      ansible.builtin.service:
        name: networking
        state: restarted
  
    - name: Reload Sysctl
      ansible.builtin.command: 
        cmd: /usr/bin/sysctl -p
