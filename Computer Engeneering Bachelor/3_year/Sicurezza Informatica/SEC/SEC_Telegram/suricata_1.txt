Lo studente deve costruire ( e validare ) una regola suricata che identifichi il traffico in uscita per il portale netflix.com

Nota bene:

La regola va generata con un certo criterio. Che significa? Significa che una richiesta a netflix.com comporta più richieste a più domini!

Analizzare quindi con wireshark, o altro tool tutti domini coinvolti… Ricordate la lezione su Web Sec!

Modalità di Consegna:
- Consegnare il file netflix.rules con la/le regola/e suricata.
- Consegnare uno screenshot che mostra i log di suricata che mostrano l'alert sui diversi domini.

--RISOLUZIONE

--domini e subdomini (da trovarne almeno 3)
apiproxy-website-nlb-prod-3-ac110f6ae472b85a.elb.eu-west-1.amaz
cdn.cookielaw.org
assets.nflxext.com

--regole
alert tls any any -> any any (msg:"SURICATA TRAFFIC-ID: netflix"; tls_sni; content:"netflix.com"; isdataat:!1,relative; flow:to_server,established; flowbits: set,traffic/id/netflix; flowbits:set,traffic/label/social-network; sid:300000003; rev:1;)

alert tls any any -> any any (msg:"SURICATA TRAFFIC-ID: netflix"; tls_sni; content:"cdn.cookielaw.org"; isdataat:!1,relative; flow:to_server,established; flowbits: set,traffic/id/netflix; flowbits:set,traffic/label/social-network; sid:300000004; rev:1;)

alert tls any any -> any any (msg:"SURICATA TRAFFIC-ID: netflix"; tls_sni; content:"assets.nflxext.com"; isdataat:!1,relative; flow:to_server,established; flowbits: set,traffic/id/netflix; flowbits:set,traffic/label/social-network; sid:300000005; rev:1;)

--PASSI DA FARE:
1) Aprire Wireshark -> sudo wireshark
2) collegarsi a sito che si deve fare insomma ecco
3) su wireshark vedere domini alternativi che escono
4) segnarli!
5) copia e incollare la regola di facebook e sostituire con i domini che abbiamo trovato e il sid
6) inserire le regole in un file .rules (in questo caso seclab.rules)
7) fase di testing:
    - avviare suricata con: suricata -c suricata.yaml -eht0 (-wlan0) -vvv
    - da un altro terminale avviare i log -> tail -f /var/log/suricata/             fast.log
    - avviare la ricerca sul browser del dominio dell'esercizio
    - voila se escono i log con le regole è tutto sistemato!
